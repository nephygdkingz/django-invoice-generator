{% extends "main/base.html" %}
{% block content %}

  <style>
    /* Optional: fix table header bg in dark mode or add subtle shadows */
    .invoice-table thead th {
      background-color: #16035c;
      color: #fff;
    }
    .footer-note {
      font-size: 0.85rem;
      color: #6c757d;
      border-top: 1px solid #dee2e6;
      padding-top: 12px;
      margin-top: 30px;
    }
    /* Fix word-wrap for long text */
    td, th {
      word-wrap: break-word;
    }

    /* .logo_name_company{
        font-size: 20px;
    } */
    .title{
        font-size: 20px;
     }
    .company_info {
      font-size: 15px;
      color: #4a4d50;
    }
    .billed-to {
      font-size: 14px;
      color: #333;
      margin-bottom: 20px;
    }
    .total-due{
        background-color: #16035c !important;
        color: #fff !important;
    }
  </style>

  <div class="container my-5">
    <div class="row justify-content-center align-items-center">
        <div class="col-md-10">
            <!-- buttons -->
            <a href="{% url 'invoices:download_pdf' %}" class="btn btn-success btn-sm mb-3">Download PDF</a>
            <a href="{% url 'invoices:upload' %}" class="btn btn-secondary btn-sm mb-3">Upload Another File</a>
            <div class="card">
                <div class="card-body">
                    <!-- Header -->
                    <div class="row border-bottom pb-3 mb-4 align-items-center justify-content-center">
                        <div class="col-8">
                        {% if logo_url %}
                            <img src="{{ logo_url }}" alt="Company Logo" style="max-height: 60px; max-width: 100%;" />
                        {% else %}
                            <h4 class="logo_name_company">{{ invoice_info.company_name }}</h4>
                        {% endif %}
                        </div>
                        <div class="col-4 text-start">
                        <h2 class="fw-bold title">INVOICE</h2>
                        <small class="company_info mb-0"><strong>#{{invoice_number}}</strong><br></small>
                        <hr class="mt-0">
                        {% if request.user.userprofile.is_paid %}
                        <small class="d-block company_info ">
                            {{ invoice_info.company_name }}<br />
                            {{ invoice_info.company_address|linebreaksbr }}<br />
                            Email: {{ invoice_info.company_email }}
                        </small>
                        {% else %}
                        <small class="d-block company_info ">
                            Your Company Name<br />
                            Your Company Address<br />
                            Email: Your Company Email<br />
                            <strong>Upgrade to Pro for more features!</strong>
                            <a href="{% url 'invoices:upgrade' %}">Upgrade</a>
                        {% endif %}
                        </div>
                    </div>

                    <!-- Invoice Details -->
                    <div class="mb-4 billed-to">
                        <div class="row">
                            <div class="col-8">
                                <div><strong>Billed To:</strong></div>
                                <div>{{ invoice_info.client_name }}</div>
                                <div>{{ invoice_info.client_address|linebreaksbr }}</div>
                                <div>Email: {{ invoice_info.client_email }}</div>
                            </div>
                            <div class="col-4 mt-4">
                                <div><strong>Date:</strong> {{ invoice_info.issue_date }}</div>
                                <div><strong>Due Date:</strong> {{ invoice_info.due_date }}</div>
                            </div>
                        </div>
                        
                    </div>

                    <!-- Invoice Items Table -->
                    <table class="table table-bordered invoice-table">
                        <thead class="table-light">
                        <tr>
                            {% for key in data.0.keys %}
                            <th>{{ key|title }}</th>
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for row in data %}
                            <tr>
                            {% for value in row.values %}
                                <td>{{ value }}</td>
                            {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <!-- Totals -->
                    <div class="row justify-content-end">
                        <div class="col-6 col-md-4">
                        <table class="table table-borderless">
                            <tbody>
                            <tr>
                                <td><strong>Subtotal:</strong></td>
                                <td class="text-end">${{ grand_total|floatformat:2 }}</td>
                            </tr>
                            <tr>
                                <td><strong>Tax ({{ tax_rate }}%):</strong></td>
                                <td class="text-end">${{ tax_amount|floatformat:2 }}</td>
                            </tr>
                            <tr>
                                <td class="total-due"><strong>Total Due:</strong></td>
                                <td class="text-end fw-bold total-due">${{ total_due|floatformat:2 }}</td>
                            </tr>
                            </tbody>
                        </table>
                        </div>
                    </div>

                    <!-- Footer Note -->
                    <div class="footer-note text-center">
                        Thank you for your business!<br />
                        Please make the payment by the due date.
                    </div>
                </div>
            </div>

            

        </div>
    </div>
  </div>

{% endblock %}
